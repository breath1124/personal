---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { toUrlSlug } from "../../utils/slug";

const base = import.meta.env.BASE_URL;
const posts = await getCollection("blog", ({ data }) => !data.draft);

const tagCounts = new Map<string, number>();
for (const post of posts) {
  for (const rawTag of post.data.tags ?? []) {
    const tag = rawTag.trim();
    if (!tag) continue;
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  }
}

const tags = [...tagCounts.entries()].sort(
  (a, b) => b[1] - a[1] || a[0].localeCompare(b[0], "zh-CN")
);
---

<BaseLayout title="标签">
  <h1>标签</h1>
  <ul class="chip-list">
    {
      tags.map(([tag, count]) => (
        <li>
          <a class="chip" href={`${base}tags/${toUrlSlug(tag)}/`}>
            {tag} <span class="chip-count">({count})</span>
          </a>
        </li>
      ))
    }
  </ul>
</BaseLayout>

